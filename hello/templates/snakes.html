{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

<div class="jumbotron text-center">
	<div class="container">
		<h1>Snake Alert</h1>
		<p>Helpful if you saw a snake</p>
	</div>
</div>
<div class="container">
	<p>Useful if you spot a snake in your neighbourhood </p>
	<hr>
	<button id="alert-location">Alert your location to the Snake Rescuers.</button>

	<div>
		<label>User Location</label>
		<div id="user-location-div">
			<div id="startLat"></div>
			<div id="startLon"></div>
		</div>
	</div>
</div>
<script type="text/javascript">

	/***** Global Variables *****/

	var USER_LOCATION;

	/***** UI Controls *****/

	var userLocationDiv = $("user-location-div");

	/***** Event Handlers *****/

	/* Handler for location alert button. Triggered whenever user clicks on the button. */
	$("#alert-location").click(function () {
		/* Call translation method to ensure other relevant fields are updated accordingly */
		updateUserLocation();
	});

	/***** Snake Alert Page specific functions *****/

	/* Update user's location */
	function updateUserLocation() {

		/* Get the user's location */
		getLocation();
	}

	/***** Generic Functions *****/

	document.addEventListener("deviceready", onDeviceReady, false);
	function onDeviceReady() {
		console.log("navigator.geolocation works well");
		alert("navigator.geolocation works well");
	}

	/* Get the current location using HTML5 Geolocation */
	/* Reference: http://www.w3schools.com/html/html5_geolocation.asp */
	function getLocation() {
		if (navigator.geolocation) {
			//navigator.geolocation.getCurrentPosition(showPosition);
			navigator.geolocation.getCurrentPosition(geoSuccess, geoError, geoOptions);
		} else {
			userLocationDiv.val("Geolocation is not supported by this browser.");
		}
	}

	var geoOptions = {
		timeout: 10 * 1000
	}

	var geoSuccess = function (position) {
		startPos = position;
		document.getElementById('startLat').innerHTML = startPos.coords.latitude;
		document.getElementById('startLon').innerHTML = startPos.coords.longitude;
	};
	var geoError = function (error) {
		console.log('Error occurred. Error code: ' + error.code);
		// error.code can be:
		//   0: unknown error
		//   1: permission denied
		//   2: position unavailable (error response from location provider)
		//   3: timed out
	};

	/* Callback function to display the location */
	function showPosition(position) {
		userLocationDiv.val("Latitude: " + position.coords.latitude +
		"<br>Longitude: " + position.coords.longitude);
	}

</script>
{% endblock %}